var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{h(i.next(t))}catch(e){r(e)}}function a(t){try{h(i["throw"](t))}catch(e){r(e)}}function h(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],r=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BulletBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BulletBase.prototype,"BulletBase");var PlaneBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(PlaneBase.prototype,"PlaneBase");var BulletFactory=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BulletFactory.prototype,"BulletFactory");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var GameConfig=function(){function t(){}return t.hero={life:1,planeToggleTimeSpan:300,planeToggleCount:0,inStageAnimationTime:1e3,inStageAnimationTimeEnd:3e3},t}();__reflect(GameConfig.prototype,"GameConfig");var HeroBullet=function(t){function e(){var e=t.call(this)||this;return e.speed=12,e.power=1,e.channelPosition=0,e.bullet=new egret.Bitmap,e.bullet.texture=Utils.createBitmapByName("bullet1"),e.bulletSound=Utils.createSoundByName("bullet"),e.width=e.bullet.width,e.height=e.bullet.height,e.addChild(e.bullet),e}return __extends(e,t),e.prototype.play=function(){this.bulletSound.play(this.channelPosition,1)},e.prototype.stop=function(){this.soundChannel&&(this.channelPosition=this.soundChannel.position,this.soundChannel.stop())},e}(BulletBase);__reflect(HeroBullet.prototype,"HeroBullet",["ISound"]);var Direction;!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(Direction||(Direction={}));var HeroInStageAnimationEndEvent=function(t){function e(e,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!1),t.call(this,e,n,i)||this}return __extends(e,t),e.heroInStageAnimationEnd="HeroInStageAnimationEnd",e}(egret.Event);__reflect(HeroInStageAnimationEndEvent.prototype,"HeroInStageAnimationEndEvent");var HeroInStageRunBgEvent=function(t){function e(e,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!1),t.call(this,e,n,i)||this}return __extends(e,t),e.HeroInStageRunBgEvent="HeroInStageRunBgEvent",e}(egret.Event);__reflect(HeroInStageRunBgEvent.prototype,"HeroInStageRunBgEvent");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Hero=function(t){function e(e){var n=t.call(this)||this;return n.life=GameConfig.hero.life,n.init(),n.addChild(n.hero),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED,n.dispose,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){this.initPosition(),this.toggleHeroAnimation(),this.admissionAnimation(t)},e.prototype.init=function(){var t=this;this.distance={stageW:0,stageH:0,stageX:0,stageY:0},this.textureList=[],["hero1","hero2"].forEach(function(e,n){t.textureList.push(Utils.createBitmapByName(e))}),this.hero=new egret.Bitmap,this.hero.texture=this.textureList[0],this.timer=new egret.Timer(GameConfig.hero.planeToggleTimeSpan,GameConfig.hero.planeToggleCount),this.width=this.hero.width,this.height=this.hero.height},e.prototype.initPosition=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,n=t/2-this.width/2;this.x=n,this.y=e+this.width},e.prototype.emitBullet=function(t){t.x=this.x+this.width/2-t.width/2,t.y=this.y+this.height/2-t.height/2,this.parent.addChild(t),BulletPool.heroBulletPool.push(t);var e=t;e.play(),this.addEventListener(egret.Event.ENTER_FRAME,this.bulleMove.bind(this,t),this)},e.prototype.setDistance=function(t){this.distance.stageX=t.stageX-this.x,this.distance.stageY=t.stageY-this.y},e.prototype.admissionAnimation=function(t){var e=this,n=this.stage.stageHeight,i=.7*n-this.height/2,o=new HeroInStageAnimationEndEvent(HeroInStageAnimationEndEvent.heroInStageAnimationEnd),r=new HeroInStageRunBgEvent(HeroInStageRunBgEvent.HeroInStageRunBgEvent);egret.Tween.get(this).to({y:i},GameConfig.hero.inStageAnimationTime,egret.Ease.sineInOut).call(function(){console.log("hero背景执行"),e.dispatchEvent(r)}).to({y:n-200},GameConfig.hero.inStageAnimationTimeEnd,egret.Ease.sineInOut).call(function(){console.log("hero动画全部结束"),e.dispatchEvent(o)})},e.prototype.move=function(t){console.log("move");var e=this,n=this.distance,i=t.stageX-n.stageX,o=t.stageW-e.width+e.width/2,r=0-e.width/2;i=o>i?i:o,i=r>i?r:i;var s=t.stageY-n.stageY,a=t.stageH-e.height,h=0;s=s>a?a:s,s=s>h?s:h,e.x=i,e.y=s},e.prototype.toggleHeroAnimation=function(){this.timer.addEventListener(egret.TimerEvent.TIMER,this.toggleHeroBitMap,this),this.timer.start()},e.prototype.toggleHeroBitMap=function(t){var e=t.target.currentCount,n=e%2;this.hero.texture=this.textureList[n]},e.prototype.dispose=function(){this.removeEventListener(egret.TimerEvent.TIMER,this.toggleHeroBitMap,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.removeEventListener(egret.Event.REMOVED,this.dispose,this)},e.prototype.bulleMove=function(t){t.y-=t.speed},e}(PlaneBase);__reflect(Hero.prototype,"Hero",["IDispose"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.bulletPool=new Array,e.autoOpenFireTimer=new egret.Timer(300,0),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=this;egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause(),Utils.soundStop(e.bgContent)},egret.lifecycle.onResume=function(){egret.ticker.resume(),Utils.soundPlay(e.bgContent)},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.hero=new Hero(1),this.bgContent=new BgContent,this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("images",0,t)];case 2:return n.sent(),[4,RES.loadGroup("sounds",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.createGameScene=function(){var t=this,e=this.bgContent;this.addChild(e);var n=this.hero;this.addEventListener(HeroInStageRunBgEvent.HeroInStageRunBgEvent,function(n){n.stopImmediatePropagation(),e.runBg(),t.removeEventListener(HeroInStageRunBgEvent.HeroInStageRunBgEvent,function(){},t)},this),this.addEventListener(HeroInStageAnimationEndEvent.heroInStageAnimationEnd,function(e){e.stopImmediatePropagation(),t.touchEnabled=!0,t.autoOpenFire(),t.detect(),t.removeEventListener(HeroInStageAnimationEndEvent.heroInStageAnimationEnd,function(){},t)},this),this.addChild(n),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){var i={stageW:t.stage.stageWidth,stageH:t.stage.stageHeight,stageX:e.stageX,stageY:e.stageY};n.setDistance(i),t.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchMove,t)},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,t.touchMove,t)},this)},e.prototype.touchMove=function(t){var e={stageW:this.stage.stageWidth,stageH:this.stage.stageHeight,stageX:t.stageX,stageY:t.stageY};Utils.move(this.hero,e)},e.prototype.startAnimation=function(t){var e=this,n=new egret.HtmlTextParser,i=t.map(function(t){return n.parse(t)}),o=this.textfield,r=-1,s=function(){r++,r>=i.length&&(r=0);var t=i[r];o.textFlow=t;var n=egret.Tween.get(o);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(s,e)};s()},e.prototype.autoOpenFire=function(){this.autoOpenFireTimer.addEventListener(egret.TimerEvent.TIMER,this.autoAddBullet,this),this.autoOpenFireTimer.start()},e.prototype.autoAddBullet=function(){var t=new HeroBullet;this.hero.emitBullet(t)},e.prototype.detect=function(){var t=this;this.addEventListener(egret.Event.ENTER_FRAME,function(){BulletPool.heroBulletPool.forEach(function(e,n){e.parent&&e.y<-e.height&&(BulletPool.heroBulletPool.splice(n,1),t.removeChild(e))})},this)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var BulletPool=function(){function t(){}return t.heroBulletPool=new Array,t.enemyBulletPool=new Array,t}();__reflect(BulletPool.prototype,"BulletPool");var BgContent=function(t){function e(){var e=t.call(this)||this;e.bgUp=new egret.Bitmap,e.bgDown=new egret.Bitmap,e.channelPosition=0;var n=Utils.createBitmapByName("background");return e.bgSound=Utils.createSoundByName("bgsound"),e.bgUp.texture=n,e.bgDown.texture=n,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener(egret.Event.REMOVED,e.dispose,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight;this.bgUp.width=t,this.bgUp.height=e,this.bgUp.x=0,this.bgUp.y=-e,this.bgDown.width=t,this.bgDown.height=e,this.bgDown.x=0,this.bgDown.y=0,this.addChild(this.bgUp),this.addChild(this.bgDown),this.play()},e.prototype.runBg=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.moveBg,this)},e.prototype.moveBg=function(){this.y+=2,this.y>=this.stage.stageHeight&&(this.y=0)},e.prototype.dispose=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.moveBg,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.removeEventListener(egret.Event.REMOVED,this.dispose,this)},e.prototype.play=function(){this.soundChannel=this.bgSound.play(this.channelPosition,-1)},e.prototype.stop=function(){this.soundChannel&&(this.channelPosition=this.soundChannel.position,this.soundChannel.stop())},e}(egret.DisplayObjectContainer);__reflect(BgContent.prototype,"BgContent",["IDispose","ISound"]);var Utils=function(){function t(){}return t.createBitmapByName=function(t){var e=RES.getRes(t);return e},t.dispose=function(t){t.dispose()},t.move=function(t,e){t.move(e)},t.soundStop=function(t){t.stop()},t.soundPlay=function(t){t.play()},t.createSoundByName=function(t){return RES.getRes(t)},t}();__reflect(Utils.prototype,"Utils");